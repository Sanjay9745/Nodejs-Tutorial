<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo List</title>
  </head>
  <body>
    <h1>Todo List</h1>

    <form id="todo-form">
      <input type="text" id="task-input" placeholder="Add a task" />
      <button type="submit">Add</button>
    </form>

    <ul id="task-list">
      <!-- Tasks will be displayed here -->
    </ul>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("todo-form");
        const taskInput = document.getElementById("task-input");
        const taskList = document.getElementById("task-list");

        form.addEventListener("submit", (event) => {
          event.preventDefault();
          const task = taskInput.value.trim();
          fetch("/add?task=" + task).then((response) => {
            if (response.status === 200) {
              addTask(task);
              taskInput.value = "";
            }
          });
        });

        function addTask(task) {
          const listItem = document.createElement("li");
          listItem.textContent = task;

          const deleteButton = document.createElement("button");
          deleteButton.textContent = "Delete";
          deleteButton.addEventListener("click", () => {
            const index = Array.from(taskList.children).indexOf(listItem);
            if (index !== -1) {
              // The index variable now contains the index of listItem in taskList
              deleteTask(index);
              listItem.remove();
            }
          });

          listItem.appendChild(deleteButton);
          taskList.appendChild(listItem);
        }
        function deleteTask(index) {
          fetch("/delete?index=" + index);
        }
        // Fetch tasks from the server and display them
        fetch("/tasks")
          .then((response) => response.json())
          .then((data) => {
            data.tasks.forEach((task) => {
              addTask(task);
            });
          });
      });
    </script>
  </body>
</html>
